---
title: Перенос скриптов Azure PowerShell с AzureRM на Az
description: Сведения о действиях и инструментах для переноса скриптов с модуля AzureRM на новый модуль Az.
author: sptramer
ms.author: sttramer
manager: carmonm
ms.devlang: powershell
ms.topic: conceptual
ms.date: 05/10/2019
ms.openlocfilehash: 02b39653ebb4aa0f74d2340a7be7b35e08d5e44d
ms.sourcegitcommit: abca342d8687ca638679c049792d0cef6045837d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2019
ms.locfileid: "70052657"
---
# <a name="migrate-azure-powershell-from-azurerm-to-az"></a><span data-ttu-id="ac9de-103">Перенос Azure PowerShell с AzureRM на Az</span><span class="sxs-lookup"><span data-stu-id="ac9de-103">Migrate Azure PowerShell from AzureRM to Az</span></span>

<span data-ttu-id="ac9de-104">Модуль Az имеет равенство функций с AzureRM, но использует более короткие и единообразные имена командлетов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-104">The Az module has feature parity with AzureRM, but uses shorter and more consistent cmdlet names.</span></span>
<span data-ttu-id="ac9de-105">Скрипты, написанные для командлетов AzureRM, не смогут автоматически работать с новым модулем.</span><span class="sxs-lookup"><span data-stu-id="ac9de-105">Scripts written for the AzureRM cmdlets won't automatically work with the new module.</span></span> <span data-ttu-id="ac9de-106">Для упрощения перехода модуль Az предлагает средства, позволяющие запускать существующие скрипты, которые используют AzureRM.</span><span class="sxs-lookup"><span data-stu-id="ac9de-106">To make the transition easier, Az offers tools to allow you to run your existing scripts using AzureRM.</span></span> <span data-ttu-id="ac9de-107">Миграция всегда сопряжена со сложностями, но эта статья поможет вам начать переход на новый модуль с новым набором команд.</span><span class="sxs-lookup"><span data-stu-id="ac9de-107">No migration to a new command set is ever convenient, but this article will help you get started on transitioning to the new module.</span></span>

<span data-ttu-id="ac9de-108">Полный список критических изменений между AzureRM и Az см. [здесь](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="ac9de-108">To see the full list of breaking changes between AzureRM and Az, see the [full changes from AzureRM to Az](migrate-az-1.0.0.md).</span></span>

## <a name="ensure-existing-scripts-work-with-the-latest-azurerm-release"></a><span data-ttu-id="ac9de-109">Убедитесь, что существующие скрипты работают с последним выпуском AzureRM</span><span class="sxs-lookup"><span data-stu-id="ac9de-109">Ensure existing scripts work with the latest AzureRM release</span></span>

<span data-ttu-id="ac9de-110">Перед выполнением любых действий миграции проверьте, какие версии AzureRM установлены в вашей системе.</span><span class="sxs-lookup"><span data-stu-id="ac9de-110">Before taking any migration steps, check which versions of AzureRM are installed on your system.</span></span> <span data-ttu-id="ac9de-111">Это позволит проверить, запущены ли скрипты с последним выпуском, и поможет узнать, какие версии AzureRM необходимо удалить.</span><span class="sxs-lookup"><span data-stu-id="ac9de-111">Doing so allows you to make sure scripts are already running on the latest release, and let you know which versions of AzureRM must be uninstalled.</span></span>

<span data-ttu-id="ac9de-112">Чтобы проверить установленную версию (версии) AzureRM, выполните приведенную ниже команду.</span><span class="sxs-lookup"><span data-stu-id="ac9de-112">To check which version(s) of AzureRM you have installed, run the command:</span></span>

```powershell-interactive
Get-InstalledModule -Name AzureRM -AllVersions
```

<span data-ttu-id="ac9de-113">__Последний__ доступный выпуск AzureRM — __6.13.1__.</span><span class="sxs-lookup"><span data-stu-id="ac9de-113">The __latest__ available release of AzureRM is __6.13.1__.</span></span> <span data-ttu-id="ac9de-114">Если у вас нет этой версии, возможно, ваши существующие скрипты нужно будет дополнительно изменить для работы с модулем Az, помимо тех изменений, которые описаны здесь и в [списке критических изменений](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="ac9de-114">If you don't have this version installed, your existing scripts may need additional modification to work with the Az module beyond what's described here and in the [breaking changes list](migrate-az-1.0.0.md).</span></span>

<span data-ttu-id="ac9de-115">Если скрипты не работают с AzureRM 6.13.1, обновите их в соответствии с [руководством по переходу AzureRM с версии 5.x на 6.x](/powershell/azure/azurerm/migration-guide.6.0.0).</span><span class="sxs-lookup"><span data-stu-id="ac9de-115">If your scripts don't work with AzureRM 6.13.1, update them according to the [AzureRM 5.x to 6.x migration guide](/powershell/azure/azurerm/migration-guide.6.0.0).</span></span>
<span data-ttu-id="ac9de-116">Если вы используете более раннюю версию модуля AzureRM, найдите нужное руководство. Руководства по миграции существуют для каждого основного номера версии.</span><span class="sxs-lookup"><span data-stu-id="ac9de-116">If you use an earlier version of the AzureRM module, there are migration guides available for each major version.</span></span>

## <a name="uninstall-azurerm"></a><span data-ttu-id="ac9de-117">Удаление AzureRM</span><span class="sxs-lookup"><span data-stu-id="ac9de-117">Uninstall AzureRM</span></span>

<span data-ttu-id="ac9de-118">Модуль Az не обязательно будет совместим с любой существующей установкой AzureRM в PowerShell 5.1 для Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9de-118">The Az module is not guaranteed to be compatible with any existing AzureRM installs in PowerShell 5.1 for Windows.</span></span> <span data-ttu-id="ac9de-119">Перед установкой модуля Az [удалите AzureRM](/powershell/azure/uninstall-az-ps#uninstall-the-azurerm-module).</span><span class="sxs-lookup"><span data-stu-id="ac9de-119">Before you install the Az module, [uninstall AzureRM](/powershell/azure/uninstall-az-ps#uninstall-the-azurerm-module).</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="ac9de-120">Если вы не готовы удалить модуль AzureRM из системы, можно установить модуль Az для [PowerShell Core](/powershell/scripting/install/installing-powershell-core-on-windows) 6.x или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="ac9de-120">If you're not ready to remove the AzureRM module from your system, you can install the Az module for [PowerShell Core](/powershell/scripting/install/installing-powershell-core-on-windows) 6.x or later instead.</span></span> <span data-ttu-id="ac9de-121">PowerShell Core и PowerShell 5.1 для Windows используют разные библиотеки модуля, что позволяет избежать конфликтов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-121">PowerShell Core and PowerShell 5.1 for Windows use different module libraries, so there will be no conflicts.</span></span> <span data-ttu-id="ac9de-122">Вы также сможете [включить псевдонимы](#enable-azurerm-compatibility-aliases) в PowerShell Core.</span><span class="sxs-lookup"><span data-stu-id="ac9de-122">You can still [enable aliases](#enable-azurerm-compatibility-aliases) in PowerShell Core.</span></span>

## <a name="install-the-azure-powershell-az-module"></a><span data-ttu-id="ac9de-123">Установка модуля Az для Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="ac9de-123">Install the Azure PowerShell Az module</span></span>

<span data-ttu-id="ac9de-124">Первый шаг — это установка модуля Az на вашей платформе.</span><span class="sxs-lookup"><span data-stu-id="ac9de-124">The first step is to install the Az module on your platform.</span></span> <span data-ttu-id="ac9de-125">При установке модуля Az рекомендуется удалить AzureRM.</span><span class="sxs-lookup"><span data-stu-id="ac9de-125">When you install Az, it's recommended that you uninstall AzureRM.</span></span> <span data-ttu-id="ac9de-126">В последующих разделах вы узнаете, как продолжить использовать существующие скрипты и активировать режим совместимости со старыми именами командлетов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-126">In the following steps, you'll learn how to keep running your existing scripts and enable compatibility for old cmdlet names.</span></span>

<span data-ttu-id="ac9de-127">Чтобы установить модуль Az для Azure PowerShell, следуйте инструкциям, приведенным [здесь](install-az-ps.md).</span><span class="sxs-lookup"><span data-stu-id="ac9de-127">To install the Azure PowerShell Az module, follow the instructions in [Install the Az module](install-az-ps.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ac9de-128">На этом этапе можно запустить командлет [Uninstall-AzureRM](/powershell/module/az.accounts/uninstall-azurerm) в модуле Az, чтобы убедиться, что все версии AzureRM были удалены и не приведут к конфликтам.</span><span class="sxs-lookup"><span data-stu-id="ac9de-128">At this point, you might want to run the [Uninstall-AzureRM](/powershell/module/az.accounts/uninstall-azurerm) cmdlet provided in the Az module, just to make sure that all versions of AzureRM have been uninstalled and won't cause conflicts.</span></span>

## <a name="enable-azurerm-compatibility-aliases"></a><span data-ttu-id="ac9de-129">Включение псевдонимов совместимости AzureRM</span><span class="sxs-lookup"><span data-stu-id="ac9de-129">Enable AzureRM compatibility aliases</span></span>

<span data-ttu-id="ac9de-130">Благодаря удаленной AzureRM и скриптам, работающим с последней версией AzureRM, можно активировать режим совместимости для модуля Az.</span><span class="sxs-lookup"><span data-stu-id="ac9de-130">With AzureRM uninstalled and your scripts working with the latest AzureRM version, the next step is to enable the compatibility mode for the Az module.</span></span> <span data-ttu-id="ac9de-131">Режим совместимости активируется следующей командой:</span><span class="sxs-lookup"><span data-stu-id="ac9de-131">Compatibility is enabled with the command:</span></span>

```powershell-interactive
Enable-AzureRmAlias -Scope CurrentUser
```

<span data-ttu-id="ac9de-132">Псевдонимы позволяют использовать старые имена командлетов с установленным модулем Az.</span><span class="sxs-lookup"><span data-stu-id="ac9de-132">Aliases enable the ability to use old cmdlet names with the Az module installed.</span></span> <span data-ttu-id="ac9de-133">Эти псевдонимы записываются в профиль для выбранной области видимости.</span><span class="sxs-lookup"><span data-stu-id="ac9de-133">These aliases are written to the profile for the selected scope.</span></span> <span data-ttu-id="ac9de-134">Если профиль отсутствует, он будет создан.</span><span class="sxs-lookup"><span data-stu-id="ac9de-134">If no profile exists, one is created.</span></span>
<span data-ttu-id="ac9de-135">При использовании более широкой области, чем `-Scope` со значением `CurrentUser`, требуются соответствующие разрешения для создания или обновления соответствующего файла профиля.</span><span class="sxs-lookup"><span data-stu-id="ac9de-135">When using a `-Scope` broader than `CurrentUser`, the appropriate permissions are required to create or update the corresponding profile file.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac9de-136">Псевдонимы используются __только__ для имен командлетов, но не для имен модулей.</span><span class="sxs-lookup"><span data-stu-id="ac9de-136">__Only__ cmdlet names are aliased - module names aren't!</span></span> <span data-ttu-id="ac9de-137">Если вы используете `#Requires`, `Import-Module`, списки зависимостей в файле `.psd1` или полные имена командлетов, перенесите их на этом этапе, выполнив описанный в [списке критических изменений](migrate-az-1.0.0.md) процесс, касающийся имен модулей.</span><span class="sxs-lookup"><span data-stu-id="ac9de-137">If you're using `#Requires`, `Import-Module`, dependency lists in a `.psd1`, or fully-qualified cmdlet names, make sure that you migrate them at this point by following the process outlined in the [breaking changes list](migrate-az-1.0.0.md) regarding module names.</span></span>

> [!WARNING]
>
> <span data-ttu-id="ac9de-138">Можно использовать другое значение параметра `-Scope` для этой команды, но делать это не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="ac9de-138">You can use a different `-Scope` for this command, but it's not recommended.</span></span> <span data-ttu-id="ac9de-139">Псевдонимы записываются в профиль пользователя для выбранной области видимости, поэтому используйте их для как можно более узкой области.</span><span class="sxs-lookup"><span data-stu-id="ac9de-139">Aliases are written to the user profile for the selected scope, so keep enabling them to as limited a scope as possible.</span></span> <span data-ttu-id="ac9de-140">Активация псевдонимов для всей системы может вызвать проблемы у других пользователей, которые установили AzureRM в свою локальную область.</span><span class="sxs-lookup"><span data-stu-id="ac9de-140">Enabling aliases system-wide can cause issues for other users who have AzureRM installed in their local scope.</span></span>

<span data-ttu-id="ac9de-141">После активации режима псевдонимов запустите скрипты снова, чтобы убедиться, что они по-прежнему работают правильно.</span><span class="sxs-lookup"><span data-stu-id="ac9de-141">Once the alias mode is enabled, run your scripts again to confirm that they still function as expected.</span></span>
<span data-ttu-id="ac9de-142">Модуль Az изменил, добавил или сделал обязательными некоторые имена параметров.</span><span class="sxs-lookup"><span data-stu-id="ac9de-142">Some parameter names have been changed, added, or made required by the Az module.</span></span> <span data-ttu-id="ac9de-143">Типы выходных данных командлетов также могли измениться.</span><span class="sxs-lookup"><span data-stu-id="ac9de-143">Output types of cmdlets may have changed as well.</span></span> <span data-ttu-id="ac9de-144">Эти критические изменения описаны [здесь](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="ac9de-144">These changes are detailed in the [breaking changes list](migrate-az-1.0.0.md).</span></span>

## <a name="update-cmdlets-modules-and-parameters"></a><span data-ttu-id="ac9de-145">Обновления командлетов, модулей и параметров</span><span class="sxs-lookup"><span data-stu-id="ac9de-145">Update cmdlets, modules, and parameters</span></span>

<span data-ttu-id="ac9de-146">При наличии обновленных скриптов, которые запущены под псевдонимами, обновите их для использования новых командлетов и испытайте другие изменения, в частности новые возможности.</span><span class="sxs-lookup"><span data-stu-id="ac9de-146">With scripts updated and running under aliases, you can take your time to update them to use the new cmdlets and take advantage of other changes like new features.</span></span> <span data-ttu-id="ac9de-147">Для большинства скриптов достаточно только обновить имена командлетов, [следуя новой схеме именования командлетов в Az](migrate-az-1.0.0.md#cmdlet-noun-prefix-changes).</span><span class="sxs-lookup"><span data-stu-id="ac9de-147">For most scripts, you will only need to update cmdlet names, [following the new cmdlet naming scheme in Az](migrate-az-1.0.0.md#cmdlet-noun-prefix-changes).</span></span> <span data-ttu-id="ac9de-148">Могут быть и другие изменения, которые необходимо внести, чтобы скрипт заработал, в зависимости от того, какие действия он выполняет и какие компоненты Azure PowerShell он использует.</span><span class="sxs-lookup"><span data-stu-id="ac9de-148">There may also be some other changes that you need to make in order to have your scripts work, depending on what they do and which Azure PowerShell features they take advantage of.</span></span>

<span data-ttu-id="ac9de-149">Например, [командлеты хранилища BLOB-объектов](migrate-az-1.0.0.md#azstorage-previously-azurestorage-and-azurermstorage) полностью переработаны для применения новой асинхронной модели, поэтому скрипты, использующие их, будет сложнее обновить, чем те, где были изменены только имена командлетов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-149">For example, the [Blob Storage cmdlets](migrate-az-1.0.0.md#azstorage-previously-azurestorage-and-azurermstorage) have been completely reworked to use a new asynchronous model, so scripts using them will take more work to update than those where the only relevant changes were cmdlet names.</span></span>

<span data-ttu-id="ac9de-150">Даже если вам пришлось пока только сделать небольшие простые изменения скриптов или они работают без дополнительной модификации при включенной поддержке псевдонимов, прочтите [полный список критических изменений в Az 1.0.0](migrate-az-1.0.0.md), чтобы убедиться в том, что вы не используете "прозрачное" поведение псевдонимов, которое может исчезнуть после изменения имен командлетов и отключения псевдонимов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-150">Even if you've only had to make small, simple changes to your scripts up to this point - or they even work without additional modification when aliases are enabled -  read the [full list of breaking changes in Az 1.0.0](migrate-az-1.0.0.md) to make sure that you're not relying on 'transparent' behavior of aliases which could disappear after you change cmdlet names and disable aliases.</span></span>

## <a name="disable-aliases"></a><span data-ttu-id="ac9de-151">Отключение псевдонимов</span><span class="sxs-lookup"><span data-stu-id="ac9de-151">Disable aliases</span></span>

<span data-ttu-id="ac9de-152">После завершения миграции и устранения зависимости от поведения псевдонимов рекомендуется отключить псевдонимы.</span><span class="sxs-lookup"><span data-stu-id="ac9de-152">Once you've completed your migration and are no longer relying on aliasing behavior, it's recommended that you disable aliases.</span></span> <span data-ttu-id="ac9de-153">Это делается с помощью командлета [Disable-AzureRmAlias](/powershell/module/az.accounts/disable-azurermalias).</span><span class="sxs-lookup"><span data-stu-id="ac9de-153">This is done with the [Disable-AzureRmAlias](/powershell/module/az.accounts/disable-azurermalias) cmdlet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac9de-154">При выполнении этого командлета убедитесь, что __вызвали его__ для каждого параметра `-Scope`, для которого был вызван командлет `Enable-AzureRmAlias`, в противном случае в системе могут по-прежнему существовать скрипты, использующие поведения псевдонимов.</span><span class="sxs-lookup"><span data-stu-id="ac9de-154">When running this cmdlet, __make sure__ that you invoke it for each `-Scope` that `Enable-AzureRmAlias` was invoked for, otherwise there may still be scripts on your system relying on the aliasing behavior.</span></span>
